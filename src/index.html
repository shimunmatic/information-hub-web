<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>COVID-19 HUB</title>
  <base href="/">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" type="image/x-icon" href="favicon.ico">
  <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <script type='text/javascript' src='https://www.gstatic.com/charts/loader.js'></script>
<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery-csv/1.0.8/jquery.csv.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery-csv/1.0.8/jquery.csv.min.js"></script>
<script type='text/javascript'>

    google.charts.load('current', {
        'packages': ['geochart'],
        // Note: you will need to get a mapsApiKey for your project.
        // See: https://developers.google.com/chart/interactive/docs/basic_load_libs#load-settings
        'mapsApiKey': 'AIzaSyAGcAyepqsbLrm3NQ7lOvl3pHIAGG4Z_-o'
    });
    google.charts.setOnLoadCallback(drawMarkersMap);
    var csv_as_array = [];
    function drawMarkersMap() {

        $.ajax({
            url: "https://static.dwcdn.net/data/ZfgSW.csv?v=" + new Date().getMilliseconds(),
            async: false,
            success: function (csvd) {
                csv_as_array = $.csv2Array(csvd);
            },
            dataType: "text",
            complete: function () {
                console.log(csv_as_array);
            }
        });
        var transformedData = [];
        csv_as_array[0].unshift("Province");
        transformedData.push(["Province", "Name", "Total", "Deaths"]);
        for (var i = 1; i < csv_as_array.length; i++) {
            transformedData.push([getStateCodeFromName(csv_as_array[i][0]), csv_as_array[i][0] + " at " + csv_as_array[i][5], parseInt(csv_as_array[i][2], 10), parseInt(csv_as_array[i][3], 10)]);

        }

        var trData = [
            ['Province', 'Name', 'Population', 'Area'],
            ['DE-BW', 'Baden-W端rttemberg', 2761477, 1285.31],
            ['DE-BY', 'Bayern', 1024110, 181.76],
            ['DE-BE', 'Berlin', 24110, 181.76],
            ['DE-BB', 'Brandenburg', 10, 181.76],
            ['DE-HB', 'Bremen', 1324110, 181.76],
            ['DE-HH', 'Hamburg', 13210, 181.76],
            ['DE-HE', 'Hesse', 131241, 181.76],
            ['DE-NI', 'Niedersachsen', 1324110, 181.76],
            ['DE-MV', 'Mecklenburg-Vorpommern', 1324110, 181.76],
            ['DE-NW', 'Nordrhein-Westfalen', 1324110, 181.76],
            ['DE-RP', 'Rheinland-Pfalz', 1324110, 181.76],
            ['DE-SL', 'Saarland', 1324110, 181.76],
            ['DE-SN', 'Sachsen', 1324110, 181.76],
            ['DE-ST', 'Sachsen-Anhalt', 1324110, 181.76],
            ['DE-SH', 'Schleswig-Holstein', 1324110, 181.76],
            ['DE-TH', 'Th端ringen', 1324110, 181.76],

        ];

        console.log(trData);
        console.log(transformedData);

        var data = google.visualization.arrayToDataTable(transformedData);

        var options = {
            region: 'DE',
            resolution: 'provinces',
            colorAxis: { colors: ['green', 'blue'] }
        };

        var chart = new google.visualization.GeoChart(document.getElementById('chart_div'));
        chart.draw(data, options);
    };

    function getStateCodeFromName(stateName) {
        switch (stateName) {
            case 'Baden-W端rttemberg':
                return 'DE-BW';
            case 'Bayern':
                return 'DE-BY';
            case 'Berlin':
                return 'DE-BE';
            case 'Brandenburg':
                return 'DE-BB';
            case 'Bremen':
                return 'DE-HB';
            case 'Hamburg':
                return 'DE-HH';
            case 'Hessen':
                return 'DE-HE';
            case 'Niedersachsen':
                return 'DE-NI';
            case 'Mecklenburg-Vorpommern':
                return 'DE-MV';
            case 'Nordrhein-Westfalen':
                return 'DE-NW';
            case 'Rheinland-Pfalz':
                return 'DE-RP';
            case 'Saarland':
                return 'DE-SL';
            case 'Sachsen':
                return 'DE-SN';
            case 'Sachsen-Anhalt':
                return 'DE-ST';
            case 'Schleswig-Holstein':
                return 'DE-SH';
            case 'Th端ringen':
                return 'DE-TH';
            default:
                return stateName;
        }
    }
</script>
</head>
<body>
  <corona-app-root></corona-app-root>
</body>
</html>
